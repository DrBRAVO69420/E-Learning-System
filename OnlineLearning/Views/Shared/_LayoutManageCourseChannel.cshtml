<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="portalTitle"></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="~/Assest/logo.png" type="image/png">

    @Styles.Render("~/Content/kendo/css")
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/signalr")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/kendo")
    @Scripts.Render("~/bundles/custom")
    @Scripts.Render("~/bundles/pako")
    @Scripts.Render("~/bundles/waypoint")
</head>
<body id="bodyBackground" data-spy="scroll" data-target=".navbar" data-offset="50">

    @Html.Partial("~/Views/Shared/_TopNavigationBar.cshtml")

    <!-- !PAGE CONTENT! -->
    <div class="w3-main bodyContainerPadding w3-padding-16 col-md-12 padding-0" style="margin-top:44px;">
        <span id="notificationpopup" class="alert alert-info w3-right"
              style="display: none; position: fixed; z-index: 10050; margin: 0px; right:0;">

        </span>
        @Html.Partial("~/Views/Shared/_CourseChannelTopNavigation.cshtml")
        @RenderBody()
    </div>


    @RenderSection("scripts", required: false)
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="@Url.Content("~/signalr/hubs")"></script>
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNotificationMessage = function (message) {
                // Add the message to the page.
               // console.log(userid);
                //console.log(senderid);
                $('#notificationpopup').text(message);
                $('#notificationpopup').css("display", "block");
                $('#notificationpopup').fadeIn(300);
                $('#notificationpopup').delay(2500).fadeOut(300);
            };
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    // Call the Send method on the hub.
                    chat.server.send($('#senderid').val(), $('#receiverid').val(), $('#sendername').val(), $('#message').val());
                    chat.server.notify($('#senderid').val(), $('#receiverid').val(), $('#sendername').val());
                    //save message into db
                    $.ajax({
                        url: '@Url.Action("SaveChat", "Chat")',
                        data: { senderid: $('#senderid').val(), receiverid: $('#receiverid').val(), message:$('#message').val() },
                        type: "GET",
                        success: function (errorMsg) {
                            console.log("saved");
                        },
                        error: function (errorMsg) {
                        }
                    });
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });
            });
        });
        //load portal name
        $(document).ready(function () {
            $.ajax({
                url: '@Url.Action("GetAppSettingsValue", "GeneralFunction")',
                type: "GET",
                data: {key: "portalName"},
                success: function (response) {
                    $("#portalName").text(response);
                    $("#portalTitle").text('@ViewBag.Title - ' + response);
                }
            });
            $.ajax({
                url: '@Url.Action("GetUserBackgroundSetting", "GeneralFunction")',
                type: "GET",
                success: function (response) {
                    if (response == 'Dark') {
                        $('html, body').css("background-color", "#080320");
                        $("#courseTitle").css("color", "#f0ead3");
                    }
                    if (response == 'Light') {
                        $('html, body').css("background-color", "#edf7f7");
                        $("#courseTitle").css("color", "#593fc8");
                    }
                }
            });
             $.ajax({
                url: '@Url.Action("GetLoginUser", "GeneralFunction")',
                type: "GET",
                success: function (response) {
                    $("#myProfileLink").attr("href", "/account/profile/" + response.Id);
                    $("#nameLink").text(response.Name);
                    $("#profileImg").attr("src", "/UploadedFiles/" + response.ProfilePic);
                }
            });
        });
        // Get the Sidebar
        var mySidebar = document.getElementById("mySidebar");

        // Get the DIV with overlay effect
        var overlayBg = document.getElementById("myOverlay");

        // Toggle between showing and hiding the sidebar, and add overlay effect
        function w3_open() {
            if (mySidebar.style.display === 'block') {
                mySidebar.style.display = 'none';
                overlayBg.style.display = "none";
            } else {
                mySidebar.style.display = 'block';
                overlayBg.style.display = "block";
                 $.ajax({
                    url: '@Url.Action("GetLoginUser", "GeneralFunction")',
                    type: "GET",
                    success: function (response) {
                        $("#myProfileLink").attr("href", "/account/profile/" + response.Id);
                        $("#leftNavNameLink").text(response.Name);
                        console.log(response.Name);
                        $("#leftNavMyProfileLink").attr("src", "/UploadedFiles/" + response.ProfilePic);
                    }
                });
            }
        }
        // Close the sidebar with the close button
        function w3_close() {
            mySidebar.style.display = "none";
            overlayBg.style.display = "none";
        }


    </script>
</body>
</html>




